
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>springboot后端重点 | Aircraft</title>
    <meta name="author" content="Aircraft" />
    <meta name="description" content="谁替我上学 我可以替你睡觉" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.0.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>AIRCRAFT</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;AIRCRAFT</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>springboot后端重点</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/8/29
        </span>
        
        <span class="category">
            <a href="/categories/Learning/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Learning
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/sprintboot/" style="color: #ffa2c4">
                    sprintboot
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="springboot后端重点"><a href="#springboot后端重点" class="headerlink" title="springboot后端重点"></a>springboot后端重点</h1><h2 id="axio封装"><a href="#axio封装" class="headerlink" title="axio封装"></a>axio封装</h2><pre><code class="lang-javascript">//定制请求的实例
// import &#123; globals &#125; from &quot;@/main&quot;;
//导入axios  npm install axios
import axios from &#39;axios&#39;;


import &#123; ElMessage &#125; from &#39;element-plus&#39;
//定义一个变量,记录公共的前缀  ,  baseURL
const baseURL = &#39;/api&#39;;
const instance = axios.create(&#123; baseURL &#125;)

import &#123; useTokenStore &#125; from &#39;@/stores/token.js&#39;
//添加 Axios 请求拦截器 ，用于在请求发送之前执行某些操作
instance.interceptors.request.use(
    (config) =&gt; &#123;
        // 第一个参数是一个回调函数，它在请求发送之前被调用。这个函数接受一个 config 对象作为参数，这个对象包含了请求的所有配置。
        //请求前的回调
        //添加token
        const tokenStore = useTokenStore();
        // 检查 tokenStore 是否存在 token。
        if (tokenStore.token) &#123;
            // 如果存在 token，就将它添加到请求头的 Authorization 字段中。这通常用于 API 身份验证。
            config.headers.Authorization = tokenStore.token
        &#125;
        return config;
        // 修改后的配置被返回给 Axios，随后请求将继续进行。
    &#125;,
    (err) =&gt; &#123;
        //请求错误的回调
        // 如果请求配置过程中发生了错误，它会将错误通过 Promise.reject(err) 传递出去，以便后续的错误处理可以捕获到这个错误。
        Promise.reject(err)
    &#125;
)
/*
这段代码的主要目的是在每次发送请求之前，检查用户是否已经登录（通过 token），如果是，就将 token 添加到请求头中，
以便进行身份验证。当请求发生错误时，也会正常处理错误。这种做法常见于需要认证的 API 请求场景。
*/


/* import &#123;useRouter&#125; from &#39;vue-router&#39;
const router = useRouter(); */

import router from &#39;@/router&#39;  // &#39;@/router&#39; 将自动导入 `router/index.js` 中的默认导出 
//添加 Axios 的响应拦截器，可以在接收到服务器响应后执行某些操作。
instance.interceptors.response.use(
    result =&gt; &#123;
        // 判断业务状态码
        // 如果业务逻辑中的状态码为 0，表示请求成功，返回 result.data
        if (result.data.code === 0) &#123;
            return result.data;
        &#125;

        //操作失败
        //alert(result.data.msg?result.data.msg:&#39;服务异常&#39;)
        ElMessage.error(result.data.msg ? result.data.msg : &#39;服务异常&#39;)
        //异步操作的状态转换为失败
        return Promise.reject(result.data)

    &#125;,
    err =&gt; &#123;
        //判断响应状态码,如果为401,则证明未登录,提示请登录,并跳转到登录页面
        if (err.response.status === 401) &#123;
            ElMessage.error(&#39;请先登录&#39;)
            router.push(&#39;/login&#39;)
        &#125; else &#123;
            ElMessage.error(&#39;服务异常&#39;)
        &#125;

        return Promise.reject(err);//异步的状态转化成失败的状态
    &#125;
)

export default instance;
</code></pre>
<h2 id="文件上传功能实现"><a href="#文件上传功能实现" class="headerlink" title="文件上传功能实现"></a>文件上传功能实现</h2><pre><code class="lang-java">@RestController
public class FileUploadController &#123;

    @Autowired
    private UploadedFilesService uploadedFilesService;


    @Value(&quot;$&#123;file.upload-dir&#125;&quot;)
    private String uploadDir;

    @Value(&quot;$&#123;python.interpreter&#125;&quot;)
    private String pythonInterpreter;

&#125;
</code></pre>
<h3 id="uploadurlbyid"><a href="#uploadurlbyid" class="headerlink" title="uploadurlbyid"></a>uploadurlbyid</h3><p><code>FileUploadController</code></p>
<pre><code class="lang-java">    @PostMapping(&quot;/uploadurlbyid&quot;)
 public Result&lt;String&gt; uploadtest(@RequestParam(&quot;file&quot;) MultipartFile file, @RequestParam Integer id) &#123;
        // 检查文件是否为空
        if (file.isEmpty()) &#123;
            return Result.error(&quot;File is empty. Please upload a valid file.&quot;);
        &#125;

        // 获取并检查文件名
        String originalFilename = file.getOriginalFilename();
        if (originalFilename == null || !originalFilename.toLowerCase().endsWith(&quot;.nii&quot;)) &#123;
            return Result.error(&quot;Invalid file type. Please upload a file with .nii extension.&quot;);
        &#125;

        // 安全文件名生成
        String safeFileName = UUID.randomUUID().toString() + &quot;.nii&quot;; // 生成唯一文件名
        String filePath = uploadDir + safeFileName;

        try &#123;
            // 确保上传目录存在
            Files.createDirectories(Paths.get(uploadDir));

            // 保存上传的NII文件
            file.transferTo(new File(filePath));

            // 执行 Python 脚本并处理输出
            String sliceFilePath = executePythonScript(filePath);
            if (sliceFilePath == null) &#123;
                return Result.error(&quot;Failed to execute Python script.&quot;);
            &#125;

            // 将 JPG 文件以流的形式上传到云端
            String uploadedUrl = uploadSliceFile(sliceFilePath);

            // 保存上传链接到数据库或做其他处理
            uploadedFilesService.addFileAndUrlById(id, originalFilename, filePath, uploadedUrl);

            return Result.success(uploadedUrl);
        &#125; catch (IOException e) &#123;
            return Result.error(&quot;Failed to upload file: &quot; + e.getMessage());
        &#125;
    &#125;

    private String executePythonScript(String filePath) &#123;
        try &#123;
            String pythonScriptPath = &quot;script/extract_slice.py&quot;; // 替换为你的脚本路径
            ProcessBuilder processBuilder = new ProcessBuilder(pythonInterpreter, pythonScriptPath, filePath);
            processBuilder.redirectErrorStream(true); // 合并错误与正常输出流
            Process process = processBuilder.start();

            // 读取脚本输出
            try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()))) &#123;
                String line;
                while ((line = reader.readLine()) != null) &#123;
                    System.out.println(line); // 打印输出日志
                &#125;
            &#125;

            // 等待脚本执行完成并检查退出代码
            int exitCode = process.waitFor();
            if (exitCode != 0) &#123;
                throw new IOException(&quot;Python script error: exit code &quot; + exitCode);
            &#125;

            // 提取的 JPG 文件路径
            return filePath.replace(&quot;.nii&quot;, &quot;_middle_slice.jpg&quot;);
        &#125; catch (IOException | InterruptedException e) &#123;
            System.out.println(&quot;Error executing Python script: &quot;);
            return null;
        &#125;
    &#125;

    private String uploadSliceFile(String sliceFilePath) throws IOException &#123;

        // 将 JPG 文件以流的形式上传到云端
        try (FileInputStream fis = new FileInputStream(sliceFilePath)) &#123;
            String objectName = sliceFilePath.substring(sliceFilePath.lastIndexOf(&quot;\\&quot;) + 1);
            return AliOssUtil.uploadFile(objectName, fis);
        &#125; catch (Exception e) &#123;
            throw new RuntimeException(e);
        &#125;
    &#125;
</code></pre>
<p><code>UploadedFilesServiceImpl</code></p>
<pre><code class="lang-java">@Service
public class UploadedFilesServiceImpl implements UploadedFilesService &#123;
    @Override
    public void addFileAndUrlById(Integer associatedId, String fileName, String filePath, String uploadedUrl) &#123;
        uploadedFilesMapper.insertFileAndUrl(associatedId, fileName, filePath, uploadedUrl);
    &#125;
&#125;
</code></pre>
<p><code>UploadedFilesMapper</code></p>
<pre><code class="lang-java">@Mapper
public interface UploadedFilesMapper &#123;

    @Insert(&quot;INSERT INTO uploaded_files (associated_id, file_name, url, file_path) &quot; +
            &quot;VALUES (#&#123;associatedId&#125;, #&#123;fileName&#125;, #&#123;uploadedUrl&#125;, #&#123;filePath&#125;)&quot;)
    void insertFileAndUrl(Integer associatedId, String fileName, String filePath, String uploadedUrl);

&#125;
</code></pre>
<p><code>vue</code></p>
<pre><code class="lang-vue">&lt;el-upload
 ref=&quot;dialogUploadRef&quot;
 :action=&quot;`/api/uploadurlbyid?id=$&#123;userInfo.id&#125;`&quot;
 :headers=&quot;&#123;&#39;Authorization&#39;: tokenStore.token&#125;&quot;
 drag
 list-type=&quot;picture-card&quot;
&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Aircraft-carrier/PicGOO/images/hdzd2.png" alt=""></p>
<h3 id="getImage"><a href="#getImage" class="headerlink" title="getImage"></a>getImage</h3><p><code>FileUploadController</code></p>
<pre><code class="lang-java">@GetMapping(&quot;/getImage&quot;)
    public Result&lt;List&lt;String&gt;&gt; getImageUrls(@RequestParam Integer id) throws Exception &#123;
        String filePath = uploadedFilesService.getniipathById(id);
        List&lt;String&gt; urls = new ArrayList&lt;&gt;();

        try &#123;
            // 调用Python脚本
            String pythonScriptPath = &quot;script/segimage.py&quot;; // 替换为你的脚本路径
            ProcessBuilder processBuilder = new ProcessBuilder(pythonInterpreter, pythonScriptPath, filePath);

            processBuilder.redirectErrorStream(true); // 将错误流合并到输入流中
            Process process = processBuilder.start();

            BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
            String line;
            while ((line = reader.readLine()) != null) &#123;
                System.out.println(line); // 打印输出
            &#125;

            // 等待脚本执行完成
            int exitCode = process.waitFor();
            if (exitCode != 0) &#123;
                throw new IOException(&quot;Python script error: &quot; + exitCode);
            &#125;

            // 处理生成的JPG文件
            String sliceFilePath = filePath.replace(&quot;.nii&quot;, &quot;_slice.jpg&quot;);
            for (int i = 0; i &lt; 10; i++) &#123;
                String newsliceFilePath = sliceFilePath.replace(&quot;.jpg&quot;, &quot;_&quot; + String.valueOf(i) + &quot;.jpg&quot;);

                // 将 JPG 文件以流的形式上传到云端
                try (FileInputStream fis = new FileInputStream(newsliceFilePath)) &#123;
                    // 使用文件名作为对象名
                    String objectName = newsliceFilePath.substring(newsliceFilePath.lastIndexOf(&quot;\\&quot;) + 1);
                    String uploadedUrl = AliOssUtil.uploadFile(objectName, fis);
                    urls.add(uploadedUrl);
                &#125;
            &#125;
            return Result.success(urls);
        &#125; catch (IOException | InterruptedException e) &#123;
            return Result.error(&quot;Failed to upload file: &quot; + e.getMessage());
        &#125;
    &#125;
</code></pre>
<p><code>UploadedFilesServiceImpl</code></p>
<pre><code class="lang-java">@Service
public class UploadedFilesServiceImpl implements UploadedFilesService &#123;

    @Override
    public String getniipathById(Integer id) &#123;
        return uploadedFilesMapper.getniipathById(id);
    &#125;  

&#125;
</code></pre>
<p><code>UploadedFilesMapper</code></p>
<pre><code class="lang-java">@Mapper
public interface UploadedFilesMapper &#123;

    @Select(&quot;SELECT file_path FROM uploaded_files WHERE id = #&#123;id&#125;&quot;)
    String getniipathById(@Param(&quot;id&quot;) Integer id);

&#125;
</code></pre>
<p><code>@/api/upload.js</code></p>
<pre><code class="lang-javascript">export const ImagesService = (imgId) =&gt; &#123;
    const params = new URLSearchParams(imgId).toString();
    return request.get(`/getImage?$&#123;params&#125;`);
&#125;;
</code></pre>
<p><code>@/stores/images.js</code></p>
<pre><code class="lang-javascript">const fetchImages = async (imageId) =&gt; &#123;
    images.value = [];
    const Id = &#123;
        id: imageId
    &#125;;
    try &#123;
        const response = await ImagesService(Id);
        console.log(&#39;API Response:&#39;, response);  // 调试输出
        if (response.code === 0) &#123;  // 确保响应成功
            const imageUrls = response.data;
            imageUrls.forEach(url =&gt; &#123;
                addImage(url);
            &#125;);
            console.log(&#39;Fetched Infos:&#39;, imageList.value);  // 调试输出
        &#125; else &#123;
            console.error(&#39;Error fetching images:&#39;, response.message);
        &#125;
    &#125; catch (error) &#123;
        console.error(&#39;Error fetching images:&#39;, error);
    &#125;
&#125;;
</code></pre>
<h3 id="patientfiles"><a href="#patientfiles" class="headerlink" title="patientfiles"></a>patientfiles</h3><p><code>FileUploadController</code></p>
<pre><code class="lang-java">    @GetMapping(&quot;/patientfiles&quot;)
    public Result&lt;List&lt;UploadedFile&gt;&gt; getPatientFilesById(@RequestParam Integer id) &#123;
        if (id == null) &#123;
            return Result.error(&quot;ID cannot be null or empty&quot;);
        &#125;

        try &#123;
            return Result.success(uploadedFilesService.getPatientFilesById(id));
        &#125; catch (Exception e) &#123;
            return Result.error(&quot;Failed to get patients files: &quot; + e.getMessage());
        &#125;
    &#125;
</code></pre>
<p><code>UploadedFilesServiceImpl</code></p>
<pre><code class="lang-java">@Service
public class UploadedFilesServiceImpl implements UploadedFilesService &#123;

    @Override
    public List&lt;UploadedFile&gt; getPatientFilesById(Integer id) &#123;
        return uploadedFilesMapper.getFilesById(id);
    &#125;

&#125;
</code></pre>
<p><code>UploadedFilesMapper</code></p>
<pre><code class="lang-java">@Mapper
public interface UploadedFilesMapper &#123;

    @Select(&quot;SELECT * FROM uploaded_files WHERE associated_id = #&#123;id&#125;&quot;)
    List&lt;UploadedFile&gt; getFilesById(Integer id);

&#125;
</code></pre>
<p><code>@/api/upload.js</code></p>
<pre><code class="lang-javascript">//获取用户详细信息
export const filesNameService = (patientId) =&gt; &#123;
    // 将 patientId 对象转化为查询参数字符串
    const params = new URLSearchParams(patientId).toString();
    return request.get(`/patientfiles?$&#123;params&#125;`);
&#125;
</code></pre>
<p><code>@/stores/files.js</code></p>
<pre><code class="lang-javascript">const fetchInfos = async (userid) =&gt; &#123;
    const Id = &#123;
        id: userid
    &#125;;
    console.log(&quot;ID:&quot;, Id);
    try &#123;
        const response = await filesNameService(Id);
        console.log(&#39;API Response:&#39;, response)  // 调试输出
        if (response.code === 0) &#123;
            infos.value = response.data
            console.log(response.data);
        &#125; else &#123;
            console.error(&#39;Error fetching files:&#39;, response.message);
        &#125;
    &#125; catch (error) &#123;
        console.error(&#39;Error fetching filesName:&#39;);
    &#125;
&#125;
</code></pre>
<h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p><code>FileUploadController</code></p>
<pre><code class="lang-java">    @DeleteMapping(&quot;/delete&quot;)
    public Result&lt;String&gt; deleteFile(@RequestBody Map&lt;String, Integer&gt; params) &#123;
        Integer fileId = params.get(&quot;fileId&quot;);

        try &#123;
            // 获取文件信息
            UploadedFile file = uploadedFilesService.getFileById(fileId);
            if (file == null) &#123;
                return Result.error(&quot;File not found&quot;);
            &#125;

            uploadedFilesService.deleteFile(fileId);
            boolean isDeleted = deleteFileWithPython(file.getFilePath());
            if (!isDeleted) &#123;
                return Result.error(&quot;Failed to delete file from disk&quot;);
            &#125;

            return Result.success(&quot;File deleted successfully&quot;);
        &#125; catch (Exception e) &#123;
            return Result.error(&quot;Failed to delete file: &quot; + e.getMessage());
        &#125;
    &#125;

    private boolean deleteFileWithPython(String filePath) &#123;
        try &#123;
            ProcessBuilder pb = new ProcessBuilder(&quot;python&quot;, &quot;script/delete_file.py&quot;, filePath);
            Process process = pb.start();
            int exitCode = process.waitFor();
            return exitCode == 0;
        &#125; catch (Exception e) &#123;
            return false;
        &#125;
    &#125;
</code></pre>
<p><code>UploadedFilesServiceImpl</code></p>
<pre><code class="lang-java">@Service
public class UploadedFilesServiceImpl implements UploadedFilesService &#123;

    @Override
    public void deleteFile(Integer fileId) &#123;
        uploadedFilesMapper.deleteFile(fileId);
    &#125;

&#125;
</code></pre>
<p><code>UploadedFilesMapper</code></p>
<pre><code class="lang-java">@Mapper
public interface UploadedFilesMapper &#123;

    @Delete(&quot;DELETE FROM uploaded_files WHERE id = #&#123;fileId&#125;&quot;)
    void deleteFile(Integer fileId);

&#125;
</code></pre>
<p><code>@/api/upload.js</code></p>
<pre><code class="lang-javascript">export const deleteFileService = (data) =&gt; &#123;
    return request.delete(&quot;/delete&quot;, &#123;
        data: data
    &#125;);
&#125;;
</code></pre>
<p><code>@\components\user.vue</code></p>
<pre><code class="lang-javascript">const deleteItem = async (id, index) =&gt; &#123;
  const data = &#123;
    fileId: id
  &#125;;

  try &#123;
    const result = await deleteFileService(data);
    if (result.code === 0) &#123;
      imagesresult.value.splice(index, 1);
      console.log(result.message);
    &#125; else &#123;
      console.error(&#39;Error deleting file:&#39;, result.message);
    &#125;
  &#125; catch (error) &#123;
    console.error(&#39;Error deleting file:&#39;, error);
  &#125;
  getFilesName();
&#125;;
</code></pre>
<h3 id="patientdetails"><a href="#patientdetails" class="headerlink" title="patientdetails"></a>patientdetails</h3><p><code>DoctorPatientController</code></p>
<pre><code class="lang-java">@RestController
@RequestMapping(&quot;/doctor-patients&quot;)
@Validated
public class DoctorPatientController &#123;
    @Autowired
    private DoctorPatientService doctorPatientService;

    @GetMapping(&quot;/patientdetails&quot;)
    public Result&lt;List&lt;User&gt;&gt; getPatientDetailsByDoctorId() &#123;
        return Result.success(doctorPatientService.getPatientDetailsByDoctorId());

&#125;
</code></pre>
<p><code>DoctorPatientServiceImpl</code></p>
<pre><code class="lang-java">@Service
public class DoctorPatientServiceImpl implements DoctorPatientService &#123;
    public List&lt;User&gt; getPatientDetailsByDoctorId() &#123;
        Map&lt;String,Object&gt; map = ThreadLocalUtil.get();
        Integer doctorId = (Integer) map.get(&quot;id&quot;);
        // 获取病人 ID 列表
        List&lt;Integer&gt; patientIds = doctorPatientMapper.findPatientIdsByDoctorId(doctorId);
        // 获取病人详细信息
        return userMapper.findUsersByIds(patientIds);
    &#125;
&#125;
</code></pre>
<p><code>DoctorPatientMapper</code></p>
<pre><code class="lang-java">@Mapper
public interface DoctorPatientMapper &#123;

    @Select(&quot;SELECT patient_id FROM doctor_patient WHERE doctor_id = #&#123;doctorId&#125;&quot;)
    List&lt;Integer&gt; findPatientIdsByDoctorId(@Param(&quot;doctorId&quot;) Integer doctorId);

&#125;
</code></pre>
<p><code>UserMapper</code></p>
<pre><code class="lang-java">@Mapper
public interface UserMapper &#123;

    @Select(&quot;&lt;script&gt;&quot; +
            &quot;SELECT * FROM user WHERE id IN &quot; +
            &quot;&lt;foreach item=&#39;id&#39; collection=&#39;ids&#39; open=&#39;(&#39; separator=&#39;,&#39; close=&#39;)&#39;&gt;&quot; +
            &quot;#&#123;id&#125;&quot; +
            &quot;&lt;/foreach&gt;&quot; +
            &quot;&lt;/script&gt;&quot;)
    List&lt;User&gt; findUsersByIds(@Param(&quot;ids&quot;) List&lt;Integer&gt; ids);

&#125;
</code></pre>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 Aircraft
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Aircraft
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    
<script
    src="https://giscus.app/client.js"
    data-repo="Aircraft-carrier/git-discussions-"
    data-repo-id="R_kgDOMSMEYQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOMSMEYc4CglYu"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="light_tritanopia"
    data-lang="zh-CN"
    crossorigin
    async
></script>









    

    <canvas
        id="fireworks"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
    ></canvas>
    <script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="/js/fireworks.min.js"></script>  

    <canvas
        id="background"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"
    ></canvas>
    <script src="/js/background.min.js"></script>

    <div id="cursor"></div>
    <link rel="stylesheet" href="/css/cursor.min.css" />
    <script src="/js/cursor.min.js"></script>

</body>
</html>
